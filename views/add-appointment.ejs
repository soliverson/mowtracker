<h2>Schedule Appointment</h2>
<form action="/calendar/add-appointment" method="POST">
  <label for="customer_name">Customer:</label>
  <select name="customer_name" id="customer_name" required onchange="fillCustomerDetails()">
    <option value="">-- Select Customer --</option>
    <% customers.forEach(c => { %>
      <option value="<%= c.name %>" 
        data-phone="<%= c.phone %>" 
        data-address="<%= c.address %>"
        <%= (c.name === selectedCustomer ? 'selected' : '') %>>
        <%= c.name %>
      </option>
    <% }) %>
  </select><br>

  <label for="date">Date:</label>
  <input type="date" name="date" value="<%= new Date().toISOString().split('T')[0] %>" required><br>

  <label for="time">Time:</label>
  <input type="time" name="time"><br>

  <label for="amount_paid">Amount Paid ($):</label>
  <input type="number" name="amount_paid" step="0.01"><br>

  <label for="phone">Phone (optional):</label>
  <input type="text" name="phone" id="phone"><br>

  <label for="address">Address (optional):</label>
  <input type="text" name="address" id="address"><br>

  <label for="notes">Notes:</label><br>
  <textarea name="notes" rows="4" cols="40"></textarea><br>

  <label>
    <input type="checkbox" id="recurring" name="recurring" value="true">
    Repeat weekly
  </label><br>

  <div id="repeatOptions" style="display:none;">
    <label for="recurring_weeks">Repeat for how many weeks?</label>
    <input type="number" name="recurring_weeks" id="recurring_weeks" min="1" max="52" value="1"><br>
  </div>

  <button type="submit">Add Appointment</button>
</form>

<script>
  function fillCustomerDetails() {
    const dropdown = document.getElementById('customer_name');
    const selected = dropdown.options[dropdown.selectedIndex];
    document.getElementById('phone').value = selected.getAttribute('data-phone') || '';
    document.getElementById('address').value = selected.getAttribute('data-address') || '';
  }

  const recurringCheckbox = document.getElementById('recurring');
  const repeatOptions = document.getElementById('repeatOptions');

  recurringCheckbox.addEventListener('change', () => {
    repeatOptions.style.display = recurringCheckbox.checked ? 'block' : 'none';
  });

  window.onload = () => {
    fillCustomerDetails();
    if (recurringCheckbox.checked) repeatOptions.style.display = 'block';
  };
</script>
