<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link rel="stylesheet" href="/styles.css">
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel='stylesheet' />
</head>
<body>
  <header>
    <img src="/logo.png" alt="Hunter Mowing Co. Logo">
  </header>
  <main>
    <h2>Welcome, <%= user.name %>!</h2>
    <p>Total Income: $<%= total.toFixed(2) %></p>
    <form method="POST" action="/add-job">
      <h3>Add Mowing Job</h3>
      <input name="customer_name" placeholder="Customer Name" required>
      <input name="phone" placeholder="Phone Number">
      <textarea name="notes" placeholder="Notes (optional)"></textarea>
      <input name="date" type="date" required>
      <input name="amount_paid" placeholder="Amount Paid" type="number" step="0.01" required>
      <button type="submit">Add Job</button>
    </form>

    <h3>Job History</h3>
    <table>
      <tr><th>Customer</th><th>Phone</th><th>Date</th><th>Amount</th><th>Notes</th></tr>
      <% jobs.forEach(job => { %>
        <tr>
          <td><%= job.customer_name %></td>
          <td><%= job.phone || '' %></td>
          <td><%= job.date %></td>
          <td>$<%= job.amount_paid.toFixed(2) %></td>
          <td><%= job.notes || '' %></td>
        </tr>
      <% }) %>
    </table>

    <h3>Job Calendar</h3>
    <div id='calendar'></div>

    <br>
    <a href="/logout">Logout</a>
  </main>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: <%- JSON.stringify(jobs.map(job => ({
          title: job.customer_name,
          start: job.date
        }))) %>
      });
      calendar.render();
    });
  </script>
</body>
</html>
